---
import { getCollection, render } from "astro:content";
import type {
  ProjectEntry,
  ProjectPath,
  ProjectDetailPageProps,
} from "@/lib/types";
import ProjectLayout from "@/layouts/ProjectLayout.astro";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  const headings = await Promise.all(
    projects.map((entry) => render(entry).then((data) => data.headings))
  );

  const projects_: ProjectPath[] = projects.map(
    (entry: ProjectEntry, index: number) => ({
      params: { slug: entry.id },
      props: { entry, headings: headings[index] },
    })
  );
  return projects_;
}
const { entry, headings } = Astro.props as ProjectDetailPageProps;
const { Content } = await render(entry);
const idAndData = { headings, ...entry.data };
---

<ProjectLayout {...idAndData}>
  <Content />
</ProjectLayout>
