---
import { getCollection, render } from "astro:content";
import type { PostEntry, PostPath, PostDetailPageProps } from "@/lib/types";
import BaseLayout from "@/layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  const headings = await Promise.all(
    posts.map((entry: PostEntry) => render(entry).then((data) => data.headings))
  );

  const posts_: PostPath[] = posts.map((entry: PostEntry, index: number) => ({
    params: { slug: entry.id },
    props: { entry, headings: headings[index] },
  }));
  return posts_;
}
const { entry, headings } = Astro.props as PostDetailPageProps;
const { Content } = await render(entry);
const idAndData = { headings, ...entry.data };
---

<BaseLayout {...idAndData}>
  <Content />
</BaseLayout>
