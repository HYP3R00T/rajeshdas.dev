---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Button from "@/components/ui/Button.astro";
import { Icon } from "astro-icon/components";

const components = await getCollection("components", ({ data }) => {
  return !data.draft;
});

// Sort by order, then alphabetically
const sortedComponents = components.sort((a, b) => {
  if (a.data.order !== b.data.order) {
    return a.data.order - b.data.order;
  }
  return a.data.title.localeCompare(b.data.title);
});

// Group by category
const groupedComponents = sortedComponents.reduce(
  (acc, component) => {
    const category = component.data.category;
    if (!acc[category]) {
      acc[category] = [];
    }
    acc[category].push(component);
    return acc;
  },
  {} as Record<string, typeof components>
);

const categoryNames: Record<string, string> = {
  ui: "UI Components",
  layout: "Layout Components",
  form: "Form Components",
};
---

<BaseLayout
  title="Components"
  description="Beautifully designed components built with Astro and Tailwind CSS."
>
  <main class="mx-auto px-4 py-12">
    <!-- Header -->
    <div class="mb-12 space-y-4">
      <h1 class="text-foreground-0 text-4xl font-bold">Components</h1>
      <p class="text-foreground-2 max-w-3xl text-lg">
        Beautifully designed components that you can copy and paste into your
        apps. Built with Astro and Tailwind CSS. Accessible. Customizable. Open
        Source.
      </p>
    </div>

    <!-- Browse Components -->
    <div class="space-y-12">
      {
        Object.entries(groupedComponents).map(([category, items]) => (
          <section>
            <h2 class="text-foreground-0 mb-6 text-2xl font-semibold">
              {categoryNames[category] || category}
            </h2>
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
              {items.map((component) => (
                <div class="group border-border bg-background-2 hover:bg-background-1 rounded-lg border p-6 transition-colors duration-200">
                  <div class="mb-4 space-y-2">
                    <h3 class="text-foreground-0 group-hover:text-accent text-lg font-semibold transition-colors">
                      {component.data.title}
                    </h3>
                    <p class="text-foreground-2 line-clamp-2 text-sm">
                      {component.data.description}
                    </p>
                  </div>
                  <Button
                    variant="ghost"
                    href={`/components/${component.id}`}
                    class="group/btn h-auto p-0"
                  >
                    View Component
                    <!-- TODO: Add arrow-right.svg icon -->
                    <Icon
                      name="arrow-right"
                      class="h-4 w-4 transition-transform group-hover/btn:translate-x-1"
                    />
                  </Button>
                </div>
              ))}
            </div>
          </section>
        ))
      }
    </div>

    <!-- Getting Started -->
    <div class="border-border bg-background-1 mt-16 rounded-lg border p-8">
      <h2 class="text-foreground-0 mb-4 text-2xl font-semibold">
        Getting Started
      </h2>
      <p class="text-foreground-2 mb-6">
        Browse the components and copy the code directly into your project.
        Customize the styles to match your design system.
      </p>
      <div class="flex flex-wrap gap-4">
        <Button variant="default" href="/components/button">
          Browse Components
        </Button>
        <Button
          variant="outline"
          href="https://github.com/yourusername/yourrepo"
          target="_blank"
          rel="noopener noreferrer"
        >
          <Icon name="github" class="h-4 w-4" />
          View on GitHub
        </Button>
      </div>
    </div>
  </main>
</BaseLayout>
