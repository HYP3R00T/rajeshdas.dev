---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Button from "@/components/ui/Button.astro";

const components = await getCollection("components", ({ data }) => {
  return !data.draft;
});

// Sort by order, then alphabetically
const sortedComponents = components.sort((a, b) => {
  if (a.data.order !== b.data.order) {
    return a.data.order - b.data.order;
  }
  return a.data.title.localeCompare(b.data.title);
});

// Group by category
const groupedComponents = sortedComponents.reduce(
  (acc, component) => {
    const category = component.data.category;
    if (!acc[category]) {
      acc[category] = [];
    }
    acc[category].push(component);
    return acc;
  },
  {} as Record<string, typeof components>
);

const categoryNames: Record<string, string> = {
  ui: "UI Components",
  layout: "Layout Components",
  form: "Form Components",
};
---

<BaseLayout
  title="Components"
  description="Beautifully designed components built with Astro and Tailwind CSS."
>
  <main class="mx-auto px-4 py-12">
    <!-- Header -->
    <div class="mb-12 space-y-4">
      <h1 class="text-text-default text-4xl font-bold">Components</h1>
      <p class="text-text-muted max-w-3xl text-lg">
        Beautifully designed components that you can copy and paste into your
        apps. Built with Astro and Tailwind CSS. Accessible. Customizable. Open
        Source.
      </p>
    </div>

    <!-- Browse Components -->
    <div class="space-y-12">
      {
        Object.entries(groupedComponents).map(([category, items]) => (
          <section>
            <h2 class="text-text-default mb-6 text-2xl font-semibold">
              {categoryNames[category] || category}
            </h2>
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
              {items.map((component) => (
                <div class="group rounded-radius border-border bg-content hover:bg-elevated border p-6 transition-colors duration-200">
                  <div class="mb-4 space-y-2">
                    <h3 class="text-text-default group-hover:text-accent text-lg font-semibold transition-colors">
                      {component.data.title}
                    </h3>
                    <p class="text-text-subtle line-clamp-2 text-sm">
                      {component.data.description}
                    </p>
                  </div>
                  <Button
                    variant="ghost"
                    href={`/components/${component.id}`}
                    class="group/btn h-auto p-0"
                  >
                    View Component
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="transition-transform group-hover/btn:translate-x-1"
                    >
                      <path d="M5 12h14" />
                      <path d="m12 5 7 7-7 7" />
                    </svg>
                  </Button>
                </div>
              ))}
            </div>
          </section>
        ))
      }
    </div>

    <!-- Getting Started -->
    <div class="rounded-radius border-border bg-elevated mt-16 border p-8">
      <h2 class="text-text-default mb-4 text-2xl font-semibold">
        Getting Started
      </h2>
      <p class="text-text-muted mb-6">
        Browse the components and copy the code directly into your project.
        Customize the styles to match your design system.
      </p>
      <div class="flex flex-wrap gap-4">
        <Button variant="default" href="/components/button">
          Browse Components
        </Button>
        <Button
          variant="outline"
          href="https://github.com/yourusername/yourrepo"
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"
            ></path>
            <path d="M9 18c-4.51 2-5-2-7-2"></path>
          </svg>
          View on GitHub
        </Button>
      </div>
    </div>
  </main>
</BaseLayout>
