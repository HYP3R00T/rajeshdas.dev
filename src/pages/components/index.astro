---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Button from "@/components/ui/Button.astro";
import { Icon } from "astro-icon/components";

const components = await getCollection("components", ({ data }) => {
  return !data.draft;
});

// Sort by order, then alphabetically
const sortedComponents = components.sort((a, b) => {
  if (a.data.order !== b.data.order) {
    return a.data.order - b.data.order;
  }
  return a.data.title.localeCompare(b.data.title);
});

// Group by category
const groupedComponents = sortedComponents.reduce(
  (acc, component) => {
    const category = component.data.category;
    if (!acc[category]) {
      acc[category] = [];
    }
    acc[category].push(component);
    return acc;
  },
  {} as Record<string, typeof components>,
);

const categoryNames: Record<string, string> = {
  ui: "UI Components",
  layout: "Layout Components",
  form: "Form Components",
};
---

<BaseLayout
  title="Components"
  description="Beautifully designed components built with Astro and Tailwind CSS."
>
  <main class="mx-auto max-w-7xl px-6 py-16 md:px-12">
    <!-- Header -->
    <div class="mb-16 space-y-4">
      <h1
        class="text-foreground-0 text-5xl font-extrabold uppercase"
        style="font-family: 'Space Grotesk', sans-serif; line-height: 1.1;"
      >
        Components
      </h1>
      <p class="text-foreground-1 max-w-3xl text-base tracking-wide uppercase">
        Primitive UI components designed with a consistent design system. Copy,
        customize, and integrate into your projects.
      </p>
    </div>

    <!-- Divider -->
    <div class="border-border mb-16 border-t"></div>

    <!-- Browse Components -->
    <div class="space-y-16">
      {
        Object.entries(groupedComponents).map(([category, items]) => (
          <section>
            <h2
              class="text-foreground-0 mb-8 text-2xl font-bold tracking-wider uppercase"
              style="font-family: 'Space Grotesk', sans-serif;"
            >
              {categoryNames[category] || category}
            </h2>
            <div class="border-border space-y-0 border-t">
              {items.map((component) => (
                <a
                  href={`/components/${component.id}`}
                  class="group border-border hover:bg-background-hover block border-b px-8 py-8 transition-colors md:py-12"
                >
                  <div class="flex items-start justify-between">
                    <div class="grow">
                      <h3 class="text-foreground-0 group-hover:text-foreground-muted mb-2 text-xl font-semibold transition-colors md:text-2xl">
                        {component.data.title}
                      </h3>
                      <p class="text-foreground-1 text-sm leading-relaxed">
                        {component.data.description}
                      </p>
                    </div>
                    <div class="ml-4 shrink-0">
                      <Icon
                        name="arrow-up-right"
                        class="text-foreground-2 group-hover:text-foreground-0 h-5 w-5 transition-colors"
                      />
                    </div>
                  </div>
                </a>
              ))}
            </div>
          </section>
        ))
      }
    </div>

    <!-- Divider -->
    <div class="border-border my-16 border-t"></div>

    <!-- Getting Started -->
    <section class="space-y-8">
      <div>
        <h2
          class="text-foreground-0 mb-4 text-2xl font-bold tracking-wider uppercase"
          style="font-family: 'Space Grotesk', sans-serif;"
        >
          Getting Started
        </h2>
        <p class="text-foreground-1 max-w-3xl text-sm leading-relaxed">
          Browse the components and copy the code directly into your project.
          Each component is designed to be modular and customizable to match
          your specific needs.
        </p>
      </div>
      <div class="flex flex-wrap gap-4">
        <Button variant="default" href="/components/button">
          Browse All Components
        </Button>
      </div>
    </section>
  </main>
</BaseLayout>
