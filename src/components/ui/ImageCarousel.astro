---
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import Button from "@/components/ui/Button.astro";

interface Props {
  images: any[];
  projectTitle: string;
  imageAlt?: string;
}

const { images, projectTitle, imageAlt } = Astro.props;
const totalImages = images.length;
---

<div class="relative h-full min-h-60 overflow-hidden">
  <!-- Image Container -->
  <div class="image-carousel-container h-full w-full" data-total={totalImages}>
    {
      images.map((img, idx) => (
        <div
          class="carousel-slide absolute inset-0"
          data-index={idx}
          style={`display: ${idx === 0 ? "block" : "none"}`}
        >
          <Image
            src={img}
            alt={imageAlt || `${projectTitle} - Image ${idx + 1}`}
            class="h-full w-full object-cover"
          />
        </div>
      ))
    }
  </div>

  <!-- Navigation Overlay (visible on image hover) -->
  {
    totalImages > 1 && (
      <div class="absolute inset-0 flex items-center justify-between bg-black/0 p-4 opacity-0 transition-opacity duration-300 hover:opacity-100">
        <Button
          aria-label="Previous image"
          data-carousel-container=".image-carousel-container"
          size="icon"
          variant="ghost"
          class="carousel-prev"
        >
          <Icon name="arrow-left" class="text-foreground-0 size-6" />
        </Button>
        <Button
          aria-label="Previous image"
          data-carousel-container=".image-carousel-container"
          size="icon"
          variant="ghost"
          class="carousel-next"
        >
          <Icon name="arrow-right" class="text-foreground-0 size-6" />
        </Button>
      </div>
    )
  }
</div>

<script>
  document.addEventListener("astro:page-load", () => {
    // Find all carousel containers on the page
    const carousels = document.querySelectorAll(".image-carousel-container");

    carousels.forEach((carousel) => {
      let currentIndex = 0;
      const totalSlides = parseInt(
        carousel.getAttribute("data-total") ?? "1",
        10,
      );
      const slides = carousel.querySelectorAll(".carousel-slide");

      // Find the navigation buttons for this carousel
      const navContainer = carousel.parentElement;
      const prevBtn = navContainer?.querySelector(".carousel-prev");
      const nextBtn = navContainer?.querySelector(".carousel-next");
      const counterCurrent = navContainer?.querySelector(
        ".carousel-counter-current",
      );

      function updateCarousel() {
        // Hide all slides
        slides.forEach((slide) => {
          (slide as HTMLElement).style.display = "none";
        });

        // Show current slide
        (slides[currentIndex] as HTMLElement).style.display = "block";

        // Update counter
        if (counterCurrent) {
          counterCurrent.textContent = String(currentIndex + 1);
        }
      }

      function goToPrev() {
        currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
        updateCarousel();
      }

      function goToNext() {
        currentIndex = (currentIndex + 1) % totalSlides;
        updateCarousel();
      }

      // Attach event listeners
      prevBtn?.addEventListener("click", goToPrev);
      nextBtn?.addEventListener("click", goToNext);
    });
  });
</script>
