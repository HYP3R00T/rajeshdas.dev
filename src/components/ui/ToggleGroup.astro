---
import type { HTMLAttributes } from "astro/types";

type ToggleOrientation = "horizontal" | "vertical";

interface ToggleOption {
  label: string;
  value: string;
}

interface ToggleGroupProps extends HTMLAttributes<"div"> {
  name: string;
  options: ToggleOption[];
  value?: string;
  orientation?: ToggleOrientation;
  class?: string;
}

const {
  name,
  options,
  value: selectedValue,
  orientation = "horizontal",
  class: className,
  ...rest
} = Astro.props as ToggleGroupProps;

const baseClasses = "inline-flex gap-1";

const orientationClasses: Record<ToggleOrientation, string> = {
  horizontal: "flex-row",
  vertical: "flex-col",
};

const classes = [
  baseClasses,
  orientationClasses[orientation] ?? orientationClasses.horizontal,
  className?.trim(),
]
  .filter(Boolean)
  .join(" ");

const buttonBaseClasses =
  "px-4 py-2 text-xs font-medium tracking-wider uppercase border transition-colors cursor-pointer";
const buttonDefaultClasses =
  "border-border text-foreground-1 hover:border-border-strong hover:text-foreground-0";
const buttonActiveClasses =
  "border-foreground-0 bg-foreground-0 text-background-0";
---

<div class={classes} role="group" {...rest}>
  {
    options.map((option) => (
      <label class="flex cursor-pointer items-center">
        <input
          type="radio"
          name={name}
          value={option.value}
          checked={selectedValue === option.value}
          class="hidden"
        />
        <button
          type="button"
          data-toggle-value={option.value}
          class={`${buttonBaseClasses} ${
            selectedValue === option.value
              ? buttonActiveClasses
              : buttonDefaultClasses
          }`}
          onclick={`this.previousElementSibling.checked = true; window.dispatchEvent(new CustomEvent('toggle-change', { detail: { name: '${name}', value: '${option.value}' } }))`}
        >
          {option.label}
        </button>
      </label>
    ))
  }
</div>

<style>
  input[hidden] {
    display: none;
  }
</style>
