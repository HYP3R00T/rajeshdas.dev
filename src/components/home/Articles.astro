---
import { getCollection } from "astro:content";
import PostCard from "@/components/post/PostCard.astro";
import FeaturedCard from "@/components/post/FeaturedCard.astro";

const posts = await getCollection("posts").then((entries) =>
  entries.filter((entry) => !entry.data.draft)
);

posts.sort((a, b) => {
  const aDate = new Date(a.data.modDatetime ?? a.data.pubDatetime).valueOf();
  const bDate = new Date(b.data.modDatetime ?? b.data.pubDatetime).valueOf();
  return bDate - aDate;
});

const featured = posts.find((p) => p.data.featured) ?? posts[0];
const leftPosts = posts.filter((p) => p.id !== featured?.id).slice(0, 2);
---

<section>
  <h1 transition:name="latest-articles">Latest articles</h1>
  <a href="/post/">View all</a>
  {leftPosts.map((post) => <PostCard post={post} />)}
  {featured && <FeaturedCard post={featured} />}
</section>
