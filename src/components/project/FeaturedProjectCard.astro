---
import { Icon } from "astro-icon/components";
import Button from "@/components/ui/Button.astro";
import Badge from "@/components/ui/Badge.astro";
import ImageCarousel from "@/components/ui/ImageCarousel.astro";
import defaultCardBg from "@/assets/card-bg.jpg";
import { formatMonthYearRange } from "@/lib/utils";

interface Props {
  project: {
    id: string;
    data: {
      icon?: string;
      title: string;
      description: string;
      technologies: string[];
      images?: ImageMetadata[];
      imageAlt?: string;
      openSource?: boolean;
      hasPage?: boolean;
      startDate?: Date;
      endDate?: Date;
    };
  };
}

const { project } = Astro.props;
const projectImages =
  project.data.images && project.data.images.length > 0
    ? project.data.images
    : [defaultCardBg];
const projectDates = formatMonthYearRange(
  project.data.startDate,
  project.data.endDate,
);
---

<div
  class="group border-border hover:bg-background-1/50 border-r border-b border-l transition-colors"
>
  <div class="grid md:grid-cols-2">
    <!-- Image Section (not linked) -->
    <div>
      <ImageCarousel
        images={projectImages}
        projectTitle={project.data.title}
        imageAlt={project.data.imageAlt}
      />
    </div>

    <!-- Content Section (linked) -->
    {
      project.data.hasPage !== false ? (
        <a
          href={`/project/${project.id}/`}
          class="flex flex-col justify-between p-8 transition-colors md:p-12"
        >
          <div>
            <div class="mb-4 flex items-center justify-between">
              <Button as="div" variant="outline" size="icon-lg">
                <Icon
                  name={project.data.icon || "github"}
                  class="text-foreground-0 size-6"
                />
              </Button>
              {project.data.openSource && (
                <Badge variant="outline">OPEN SOURCE</Badge>
              )}
            </div>

            <h2
              class="group-hover:text-foreground-1 text-foreground-0 mb-4 text-2xl uppercase transition-colors md:text-3xl"
              style="font-family: 'Space Grotesk', sans-serif; font-weight: 700;"
            >
              {project.data.title}
            </h2>

            <p class="text-foreground-1 mb-6 text-sm leading-relaxed">
              {project.data.description}
            </p>

            {projectDates && (
              <div class="text-foreground-2 mb-4 text-xs tracking-wide">
                {projectDates}
              </div>
            )}
          </div>

          {project.data.technologies &&
            project.data.technologies.length > 0 && (
              <div class="text-foreground-2 text-xs tracking-wide">
                {project.data.technologies.join(" • ")}
              </div>
            )}
        </a>
      ) : (
        <div class="flex flex-col justify-between p-8 transition-colors md:p-12">
          <div>
            <div class="mb-4 flex items-center justify-between">
              <Button as="div" variant="outline" size="icon-lg">
                <Icon
                  name={project.data.icon || "github"}
                  class="text-foreground-0 size-6"
                />
              </Button>
              {project.data.openSource && (
                <Badge variant="outline">OPEN SOURCE</Badge>
              )}
            </div>

            <h2
              class="group-hover:text-foreground-1 text-foreground-0 mb-4 text-2xl uppercase transition-colors md:text-3xl"
              style="font-family: 'Space Grotesk', sans-serif; font-weight: 700;"
            >
              {project.data.title}
            </h2>

            <p class="text-foreground-1 mb-6 text-sm leading-relaxed">
              {project.data.description}
            </p>

            {projectDates && (
              <div class="text-foreground-2 mb-4 text-xs tracking-wide">
                {projectDates}
              </div>
            )}
          </div>

          {project.data.technologies &&
            project.data.technologies.length > 0 && (
              <div class="text-foreground-2 text-xs tracking-wide">
                {project.data.technologies.join(" • ")}
              </div>
            )}
        </div>
      )
    }
  </div>
</div>
