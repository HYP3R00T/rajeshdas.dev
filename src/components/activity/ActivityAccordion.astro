---
import Accordion from "@/components/ui/Accordion.astro";
import type { GitHubEvent, ProjectInfo } from "@/lib/types";
import {
  getEventInfo,
  formatDate,
  getProjectName,
} from "@/lib/github-activity";
import projectsData from "@data/project.json";

interface Props {
  event: GitHubEvent;
  showProjectName?: boolean;
}

const { event, showProjectName = false } = Astro.props;
const { actionPhrase, icon } = getEventInfo(event.type);
const projectName = getProjectName(event.project_id);
const formattedDate = formatDate(event.at);
const projectInfo: ProjectInfo | undefined = projectsData.projects.find(
  (p: ProjectInfo) => p.id === event.project_id
);
const githubUrl = `https://github.com/${event.project_id}`;
---

<Accordion>
  <div slot="header-left">
    <span>{actionPhrase}</span>
    <span>{event.title}</span>
  </div>
  <div slot="header-right">
    {showProjectName && <span>{projectName}</span>}
    <span>{formattedDate}</span>
  </div>
  <div slot="content">
    {
      projectInfo && (
        <div>
          <h3>{projectInfo.title}</h3>
          <p>{projectInfo.short_description}</p>
          <nav>
            <a href={githubUrl} target="_blank" rel="noopener noreferrer">
              GitHub
            </a>
            {projectInfo.demo_url && (
              <a
                href={
                  projectInfo.demo_url.startsWith("http")
                    ? projectInfo.demo_url
                    : `https://${projectInfo.demo_url}`
                }
                target="_blank"
                rel="noopener noreferrer"
              >
                Demo
              </a>
            )}
            {event.url && (
              <a href={event.url} target="_blank" rel="noopener noreferrer">
                View Event
              </a>
            )}
          </nav>
          {projectInfo.tags && projectInfo.tags.length > 0 && (
            <div>
              {projectInfo.tags.map((tag: string) => (
                <span>#{tag}</span>
              ))}
            </div>
          )}
        </div>
      )
    }
  </div>
</Accordion>
