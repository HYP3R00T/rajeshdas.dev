---
import Accordion from "@/components/ui/Accordion.astro";
import type { GitHubEvent, ProjectInfo } from "@/lib/types";
import {
  getEventInfo,
  formatDate,
  getProjectName,
} from "@/lib/github-activity";
import projectsData from "@data/project.json";

interface Props {
  event: GitHubEvent;
}

const { event } = Astro.props;
const { actionPhrase } = getEventInfo(event.type);
const projectName = getProjectName(event.project_id);
const formattedDate = formatDate(event.at);
const projectInfo: ProjectInfo | undefined = projectsData.projects.find(
  (p: ProjectInfo) => p.id === event.project_id
);
const githubUrl = `https://github.com/${event.project_id}`;
---

<Accordion icon="caret-down">
  <div
    slot="trigger"
    class="flex w-full items-center justify-between gap-4 py-2"
  >
    <div class="flex min-w-0 flex-col">
      <span class="text-text-subtle font-mono text-xs">
        {formattedDate}
      </span>
      <span class="text-text-default truncate text-sm font-semibold">
        {actionPhrase} Â· {projectName}
      </span>
      <span class="text-text-faint truncate text-sm">{event.title}</span>
    </div>
  </div>
  <div slot="content" class="flex flex-col gap-3">
    {
      projectInfo && (
        <div class="flex flex-col gap-3">
          <div class="flex flex-col gap-1">
            <h4 class="text-text-default text-base font-semibold">
              {projectInfo.title}
            </h4>
            <p class="text-text-subtle text-sm leading-relaxed">
              {projectInfo.short_description}
            </p>
          </div>
          <nav class="flex flex-wrap gap-3 text-sm font-medium">
            <a
              href={githubUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="text-accent hover:underline"
            >
              GitHub
            </a>
            {projectInfo.demo_url && (
              <a
                href={
                  projectInfo.demo_url.startsWith("http")
                    ? projectInfo.demo_url
                    : `https://${projectInfo.demo_url}`
                }
                target="_blank"
                rel="noopener noreferrer"
                class="text-accent hover:underline"
              >
                Demo
              </a>
            )}
            {event.url && (
              <a
                href={event.url}
                target="_blank"
                rel="noopener noreferrer"
                class="text-accent hover:underline"
              >
                View Event
              </a>
            )}
          </nav>
          {projectInfo.tags && projectInfo.tags.length > 0 && (
            <div class="flex flex-wrap gap-2">
              {projectInfo.tags.map((tag: string) => (
                <span class="bg-elevated text-text-faint rounded px-2 py-0.5 font-mono text-xs">
                  #{tag}
                </span>
              ))}
            </div>
          )}
        </div>
      )
    }
  </div>
</Accordion>
