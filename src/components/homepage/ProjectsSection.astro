---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import Button from "@/components/ui/Button.astro";
import Badge from "../ui/Badge.astro";

// Get all projects, sorted by order, filter drafts
const allProjects = await getCollection("projects");
const projects = allProjects
  .filter((p) => !p.data.draft)
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
---

<section
  class="stripe-pattern relative flex items-center justify-center px-6 py-32 md:px-12"
>
  <div class="mx-auto w-full max-w-7xl">
    <!-- Badge -->
    <Badge variant="accent">Selected Work</Badge>
    <h1 class="text-section-heading my-8">
      <div>PROJECTS</div>
    </h1>

    <p
      class="text-foreground-muted max-w-2xl space-y-6 text-base leading-relaxed md:text-lg"
    >
      Recent projects and tools I've built to solve real-world DevOps challenges
    </p>

    <div class="bg-border mt-8 p-px">
      <div class="bg-border grid gap-px md:grid-cols-2">
        {
          projects.map((project, index) => (
            <div class="group hover:bg-background-hover/50 bg-black p-8 transition-colors md:p-12">
              <div class="mb-8 flex items-start justify-between">
                <Button as="div" variant="outline" size="icon-lg">
                  <Icon
                    name={project.data.icon || "github"}
                    class="text-foreground-0 size-6"
                  />
                </Button>
                <div class="text-foreground-3 text-sm">
                  {String(index + 1).padStart(2, "0")}
                </div>
              </div>

              <h3 class="text-foreground-0 font-display mb-4 text-2xl tracking-tight uppercase md:text-3xl">
                {project.data.title}
              </h3>

              <p class="text-foreground-1 mb-6 text-sm leading-relaxed">
                {project.data.description}
              </p>

              <div class="text-foreground-2 text-xs tracking-wide">
                {project.data.technologies.join(" â€¢ ")}
              </div>
            </div>
          ))
        }
      </div>
    </div>

    <div class="mt-12 text-center">
      <a href="/project/">
        <Button size="lg" class="uppercase">View All Projects</Button>
      </a>
    </div>
  </div>
</section>
