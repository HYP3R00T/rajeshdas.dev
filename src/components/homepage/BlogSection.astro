---
import { getCollection } from "astro:content";
import PostCard from "@/components/post/PostCard.astro";
import Button from "../ui/Button.astro";
import Badge from "../ui/Badge.astro";

// Get all posts, filter drafts, sort by date (newest first)
const allPosts = await getCollection("posts");
const posts = allPosts
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDatetime.getTime() - a.data.pubDatetime.getTime())
  .slice(0, 6);
---

<section class="relative bg-black px-6 py-32 md:px-12">
  <div class="mx-auto max-w-7xl">
    <Badge variant="accent">Insights</Badge>
    <h1 class="text-section-heading my-8">
      <div>ARTICLES</div>
    </h1>
    <p
      class="text-foreground-muted max-w-2xl space-y-6 text-base leading-relaxed md:text-lg"
    >
      Thoughts and learnings on DevOps, infrastructure, and automation
    </p>

    <div class="border-border space-y-0 border-t">
      {posts.map((post, index) => <PostCard post={post} index={index} />)}
    </div>

    <div class="mt-12 text-center">
      <a href="/post/">
        <Button size="lg" class="uppercase">View All Articles</Button>
      </a>
    </div>
  </div>
</section>
