---
import { getCollection } from "astro:content";

// Get all posts, filter drafts, sort by date (newest first)
const allPosts = await getCollection("posts");
const posts = allPosts
    .filter((p) => !p.data.draft)
    .sort((a, b) => b.data.pubDatetime.getTime() - a.data.pubDatetime.getTime())
    .slice(0, 6);

// Helper function to estimate read time
function estimateReadTime(text: string): number {
    const wordsPerMinute = 200;
    const wordCount = text.split(/\s+/).length;
    return Math.max(1, Math.ceil(wordCount / wordsPerMinute));
}

// Helper function to format date
function formatDate(date: Date): string {
    return new Date(date)
        .toLocaleDateString("en-US", {
            month: "short",
            day: "numeric",
            year: "numeric",
        })
        .toUpperCase();
}
---

<section class="relative bg-black px-6 py-32 md:px-12">
    <div class="mx-auto max-w-[1400px]">
        <div class="mb-20">
            <div class="text-section-label mb-4">Insights</div>
            <h2 class="text-section-heading mb-8 text-white">ARTICLES</h2>
            <p
                class="max-w-2xl text-sm tracking-wide text-white/60 uppercase md:text-base"
            >
                Thoughts and learnings on DevOps, infrastructure, and automation
            </p>
        </div>

        <div class="space-y-0 border-t border-white/10">
            {
                posts.map((post, index) => (
                    <a
                        href={`/post/${post.id}/`}
                        class="group block border-b border-white/10 px-6 py-8 transition-colors hover:bg-white/5 md:py-12"
                    >
                        <div class="flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
                            <div class="flex-grow">
                                <div class="mb-4 flex items-center gap-4">
                                    <span class="text-sm text-white/20">
                                        {String(index + 1).padStart(2, "0")}
                                    </span>
                                    <div class="flex items-center gap-4 text-xs text-white/40">
                                        <time
                                            dateTime={post.data.pubDatetime.toISOString()}
                                        >
                                            {formatDate(post.data.pubDatetime)}
                                        </time>
                                        <span>â€¢</span>
                                        <span>
                                            {estimateReadTime(
                                                post.data.description,
                                            )}{" "}
                                            MIN
                                        </span>
                                    </div>
                                </div>

                                <h3
                                    class="mb-3 text-xl text-white transition-colors group-hover:text-white/80 md:text-2xl"
                                    style="font-family: 'Space Grotesk', sans-serif; font-weight: 600;"
                                >
                                    {post.data.title}
                                </h3>

                                <p class="max-w-2xl text-sm leading-relaxed text-white/60">
                                    {post.data.description}
                                </p>
                            </div>

                            <div class="flex-shrink-0">
                                <div class="border border-white/20 p-3 transition-colors group-hover:bg-white group-hover:text-black">
                                    <svg
                                        class="h-6 w-6"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 0m0 0l3 0m-3 0v4m0 0h3m-3 0h-3"
                                        />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </a>
                ))
            }
        </div>

        <div class="mt-12 text-center">
            <a
                href="/post/"
                class="inline-block border border-white bg-transparent px-8 py-4 text-xs tracking-wider text-white uppercase transition-colors hover:bg-white hover:text-black"
            >
                View All Articles
            </a>
        </div>
    </div>
</section>
